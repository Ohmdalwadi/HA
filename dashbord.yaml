title: Policy Engine
theme: iOS Light Mode
views:
  - title: Control
    icon: mdi:tune-variant
    type: sidebar
    background: >
      radial-gradient(ellipse at top left, rgba(191, 219, 254, 0.6) 0%,
      transparent 50%),

      radial-gradient(ellipse at bottom right, rgba(219, 234, 254, 0.5) 0%,
      transparent 50%),

      linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0f9ff 100%)
    cards:
      - type: custom:mushroom-chips-card
        alignment: center
        chips:
          - type: template
            icon: mdi:home-account
            content: |
              {{ 'Home' if is_state('input_boolean.mode_home','on')
                 else 'Guest' if is_state('input_boolean.mode_guest','on')
                 else 'Sleep' if is_state('input_boolean.mode_sleep','on')
                 else 'Away' if is_state('input_boolean.mode_away','on')
                 else 'No Mode' }}
            icon_color: |
              {{ 'green' if is_state('input_boolean.mode_home','on')
                 else 'purple' if is_state('input_boolean.mode_guest','on')
                 else 'blue' if is_state('input_boolean.mode_sleep','on')
                 else 'amber' if is_state('input_boolean.mode_away','on')
                 else 'grey' }}
            card_mod:
              style: |
                ha-card {
                  background: white !important;
                  box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
                }
          - type: template
            icon: mdi:lightning-bolt
            content: |
              {{ states('sensor.house_energy_today') ~ ' kWh' }}
            icon_color: >
              {% set energy = states('sensor.house_energy_today') | float(0) %}

              {% set budget = states('input_number.daily_energy_budget_kwh') |
              float(100) %}

              {% if energy >= budget %}red

              {% elif energy >= budget * 0.8 %}amber

              {% else %}green

              {% endif %}
            card_mod:
              style: |
                ha-card {
                  background: white !important;
                  box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
                }
          - type: template
            icon: mdi:weather-night
            content: >
              {% set now = now().time() %}

              {% set start = states('input_datetime.quiet_start') %}

              {% set end = states('input_datetime.quiet_end') %}

              {{ 'Quiet Hours' if start <= now.strftime('%H:%M:%S') <= end else
              'Active' }}
            icon_color: >
              {% set now = now().time() %}

              {% set start = states('input_datetime.quiet_start') %}

              {% set end = states('input_datetime.quiet_end') %}

              {{ 'indigo' if start <= now.strftime('%H:%M:%S') <= end else
              'grey' }}
            card_mod:
              style: |
                ha-card {
                  background: white !important;
                  box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
                }
      - type: custom:mushroom-title-card
        title: Policy Engine
        subtitle: Smart Home Control Dashboard
        card_mod:
          style: |
            ha-card {
              background: rgba(255, 255, 255, 0.95) !important;
              box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
              color: #1f2937 !important;
              margin: 12px 0 !important;
            }
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## 🏠 Active Mode
              *Select your current home status*
            card_mod:
              style: |
                ha-card {
                  background: none !important;
                  box-shadow: none !important;
                  padding: 8px 0 4px 0 !important;
                  margin: 0 !important;
                  font-weight: 700 !important;
                  color: #1f2937 !important;
                }
                h2 {
                  font-size: 18px !important;
                  margin: 0 0 4px 0 !important;
                }
                em {
                  font-size: 13px !important;
                  color: #6b7280 !important;
                }
          - type: grid
            columns: 2
            square: false
            cards:
              - type: custom:mushroom-template-card
                primary: Home
                secondary: Living & Active
                icon: mdi:home
                icon_color: >
                  {{ 'green' if is_state('input_boolean.mode_home','on') else
                  'grey' }}
                fill_container: true
                tap_action:
                  action: call-service
                  service: input_boolean.turn_on
                  target:
                    entity_id: input_boolean.mode_home
                card_mod:
                  style: |
                    ha-card {
                      background: {{ 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%) !important' if is_state('input_boolean.mode_home','on') else 'white !important' }};
                      border: {{ '2px solid #10b981 !important' if is_state('input_boolean.mode_home','on') else '2px solid #e5e7eb !important' }};
                      box-shadow: {{ '0 4px 12px rgba(16, 185, 129, 0.3) !important' if is_state('input_boolean.mode_home','on') else '0 2px 8px rgba(0,0,0,0.08) !important' }};
                      margin: 8px 0 !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-template-card
                primary: Guest
                secondary: Visitors Present
                icon: mdi:account-group
                icon_color: >
                  {{ 'purple' if is_state('input_boolean.mode_guest','on') else
                  'grey' }}
                fill_container: true
                tap_action:
                  action: call-service
                  service: input_boolean.turn_on
                  target:
                    entity_id: input_boolean.mode_guest
                card_mod:
                  style: |
                    ha-card {
                      background: {{ 'linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%) !important' if is_state('input_boolean.mode_guest','on') else 'white !important' }};
                      border: {{ '2px solid #a855f7 !important' if is_state('input_boolean.mode_guest','on') else '2px solid #e5e7eb !important' }};
                      box-shadow: {{ '0 4px 12px rgba(168, 85, 247, 0.3) !important' if is_state('input_boolean.mode_guest','on') else '0 2px 8px rgba(0,0,0,0.08) !important' }};
                      margin: 8px 0 !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-template-card
                primary: Sleep
                secondary: Rest & Quiet
                icon: mdi:power-sleep
                icon_color: >
                  {{ 'blue' if is_state('input_boolean.mode_sleep','on') else
                  'grey' }}
                fill_container: true
                tap_action:
                  action: call-service
                  service: input_boolean.turn_on
                  target:
                    entity_id: input_boolean.mode_sleep
                card_mod:
                  style: |
                    ha-card {
                      background: {{ 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%) !important' if is_state('input_boolean.mode_sleep','on') else 'white !important' }};
                      border: {{ '2px solid #3b82f6 !important' if is_state('input_boolean.mode_sleep','on') else '2px solid #e5e7eb !important' }};
                      box-shadow: {{ '0 4px 12px rgba(59, 130, 246, 0.3) !important' if is_state('input_boolean.mode_sleep','on') else '0 2px 8px rgba(0,0,0,0.08) !important' }};
                      margin: 8px 0 !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-template-card
                primary: Away
                secondary: House Empty
                icon: mdi:home-export-outline
                icon_color: >
                  {{ 'amber' if is_state('input_boolean.mode_away','on') else
                  'grey' }}
                fill_container: true
                tap_action:
                  action: call-service
                  service: input_boolean.turn_on
                  target:
                    entity_id: input_boolean.mode_away
                card_mod:
                  style: |
                    ha-card {
                      background: {{ 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%) !important' if is_state('input_boolean.mode_away','on') else 'white !important' }};
                      border: {{ '2px solid #f59e0b !important' if is_state('input_boolean.mode_away','on') else '2px solid #e5e7eb !important' }};
                      box-shadow: {{ '0 4px 12px rgba(245, 158, 11, 0.3) !important' if is_state('input_boolean.mode_away','on') else '0 2px 8px rgba(0,0,0,0.08) !important' }};
                      margin: 8px 0 !important;
                      color: #1f2937 !important;
                    }
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## 🎯 Smart Overlays
              *Additional automation layers*
            card_mod:
              style: |
                ha-card {
                  background: none !important;
                  box-shadow: none !important;
                  padding: 16px 0 4px 0 !important;
                  margin: 0 !important;
                  font-weight: 700 !important;
                  color: #1f2937 !important;
                }
                h2 {
                  font-size: 18px !important;
                  margin: 0 0 4px 0 !important;
                }
                em {
                  font-size: 13px !important;
                  color: #6b7280 !important;
                }
          - type: custom:mushroom-chips-card
            alignment: center
            chips:
              - type: template
                entity: input_boolean.overlay_wfh
                icon: mdi:laptop
                content: Work From Home
                icon_color: >
                  {{ 'green' if is_state('input_boolean.overlay_wfh','on') else
                  'grey' }}
                tap_action:
                  action: toggle
              - type: template
                entity: input_boolean.overlay_pet_home
                icon: mdi:dog
                content: Pet Home
                icon_color: >
                  {{ 'deep-orange' if
                  is_state('input_boolean.overlay_pet_home','on') else 'grey' }}
                tap_action:
                  action: toggle
              - type: template
                entity: input_boolean.meeting_now
                icon: mdi:video
                content: Meeting
                icon_color: >
                  {{ 'red' if is_state('input_boolean.meeting_now','on') else
                  'grey' }}
                tap_action:
                  action: toggle
              - type: template
                entity: input_boolean.doorbell_muted
                icon: mdi:bell-off
                content: Muted
                icon_color: >
                  {{ 'indigo' if is_state('input_boolean.doorbell_muted','on')
                  else 'grey' }}
                tap_action:
                  action: toggle
              - type: template
                entity: input_boolean.do_not_disturb
                icon: mdi:minus-circle
                content: DND
                icon_color: >
                  {{ 'blue' if is_state('input_boolean.do_not_disturb','on')
                  else 'grey' }}
                tap_action:
                  action: toggle
            card_mod:
              style: |
                ha-card {
                  background: white !important;
                  box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                  margin: 8px 0 !important;
                }
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## ✨ Quick Scenes
              *One-tap lighting presets*
            card_mod:
              style: |
                ha-card {
                  background: none !important;
                  box-shadow: none !important;
                  padding: 16px 0 4px 0 !important;
                  margin: 0 !important;
                  font-weight: 700 !important;
                  color: #1f2937 !important;
                }
                h2 {
                  font-size: 18px !important;
                  margin: 0 0 4px 0 !important;
                }
                em {
                  font-size: 13px !important;
                  color: #6b7280 !important;
                }
          - type: grid
            columns: 5
            square: true
            cards:
              - type: custom:mushroom-template-card
                icon: mdi:coffee
                icon_color: deep-orange
                primary: Relax
                layout: vertical
                tap_action:
                  action: call-service
                  service: scene.turn_on
                  target:
                    entity_id: scene.evening_relax
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-template-card
                icon: mdi:home-lightning-bolt
                icon_color: amber
                primary: Bright
                layout: vertical
                tap_action:
                  action: call-service
                  service: scene.turn_on
                  target:
                    entity_id: scene.home_bright
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-template-card
                icon: mdi:weather-night
                icon_color: indigo
                primary: Night
                layout: vertical
                tap_action:
                  action: call-service
                  service: scene.turn_on
                  target:
                    entity_id: scene.night_minimal
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-template-card
                icon: mdi:paw
                icon_color: deep-orange
                primary: Pet
                layout: vertical
                tap_action:
                  action: call-service
                  service: scene.turn_on
                  target:
                    entity_id: scene.pet_calm
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-template-card
                icon: mdi:laptop
                icon_color: green
                primary: Focus
                layout: vertical
                tap_action:
                  action: call-service
                  service: scene.turn_on
                  target:
                    entity_id: scene.wfh_focus
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## 🎮 Devices
              *Control appliances and accessories*
            card_mod:
              style: |
                ha-card {
                  background: none !important;
                  box-shadow: none !important;
                  padding: 16px 0 4px 0 !important;
                  margin: 0 !important;
                  font-weight: 700 !important;
                  color: #1f2937 !important;
                }
                h2 {
                  font-size: 18px !important;
                  margin: 0 0 4px 0 !important;
                }
                em {
                  font-size: 13px !important;
                  color: #6b7280 !important;
                }
          - type: grid
            columns: 2
            square: false
            cards:
              - type: custom:mushroom-entity-card
                entity: switch.tv_switch
                name: TV
                icon: mdi:television
                layout: horizontal
                tap_action:
                  action: toggle
                icon_color: >
                  {{ 'purple' if is_state('switch.tv_switch','on') else 'grey'
                  }}
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: switch.kettle_switch
                name: Kettle
                icon: mdi:kettle
                layout: horizontal
                tap_action:
                  action: toggle
                icon_color: >
                  {{ 'amber' if is_state('switch.kettle_switch','on') else
                  'grey' }}
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: switch.whitenoise_switch
                name: White Noise
                icon: mdi:waveform
                layout: horizontal
                tap_action:
                  action: toggle
                icon_color: >
                  {{ 'cyan' if is_state('switch.whitenoise_switch','on') else
                  'grey' }}
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
              - type: custom:mushroom-template-card
                primary: Doorbell
                secondary: Tap to simulate
                icon: mdi:doorbell
                icon_color: teal
                layout: horizontal
                tap_action:
                  action: call-service
                  service: input_boolean.turn_on
                  target:
                    entity_id: input_boolean.sim_doorbell
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## 🔐 Security
              *Lock status and controls*
            card_mod:
              style: |
                ha-card {
                  background: none !important;
                  box-shadow: none !important;
                  padding: 16px 0 4px 0 !important;
                  margin: 0 !important;
                  font-weight: 700 !important;
                  color: #1f2937 !important;
                }
                h2 {
                  font-size: 18px !important;
                  margin: 0 0 4px 0 !important;
                }
                em {
                  font-size: 13px !important;
                  color: #6b7280 !important;
                }
          - type: grid
            columns: 2
            cards:
              - type: custom:mushroom-entity-card
                entity: lock.front_door_sim
                name: Front Door
                icon: mdi:door
                layout: horizontal
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: lock.back_door_sim
                name: Back Door
                icon: mdi:door
                layout: horizontal
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## ⚡ Energy Management
              *Monitor and control power usage*
            card_mod:
              style: |
                ha-card {
                  background: none !important;
                  box-shadow: none !important;
                  padding: 16px 0 4px 0 !important;
                  margin: 0 !important;
                  font-weight: 700 !important;
                  color: #1f2937 !important;
                }
                h2 {
                  font-size: 18px !important;
                  margin: 0 0 4px 0 !important;
                }
                em {
                  font-size: 13px !important;
                  color: #6b7280 !important;
                }
          - type: grid
            columns: 3
            cards:
              - type: custom:mushroom-entity-card
                entity: sensor.house_energy_today
                name: Today
                icon: mdi:lightning-bolt
                layout: vertical
                icon_color: >
                  {% set energy = states('sensor.house_energy_today') | float(0)
                  %}

                  {% set budget = states('input_number.daily_energy_budget_kwh')
                  | float(100) %}

                  {% if energy >= budget %}red

                  {% elif energy >= budget * 0.8 %}amber

                  {% else %}green

                  {% endif %}
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: input_number.daily_energy_budget_kwh
                name: Daily Budget
                icon: mdi:cash-clock
                layout: vertical
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: input_boolean.block_fun
                name: Block Fun
                icon: mdi:gamepad-variant-outline
                layout: vertical
                icon_color: >
                  {{ 'red' if is_state('input_boolean.block_fun','on') else
                  'grey' }}
                tap_action:
                  action: toggle
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## 🐾 Pet Comfort Zone
              *Temperature and noise monitoring*
            card_mod:
              style: |
                ha-card {
                  background: none !important;
                  box-shadow: none !important;
                  padding: 16px 0 4px 0 !important;
                  margin: 0 !important;
                  font-weight: 700 !important;
                  color: #1f2937 !important;
                }
                h2 {
                  font-size: 18px !important;
                  margin: 0 0 4px 0 !important;
                }
                em {
                  font-size: 13px !important;
                  color: #6b7280 !important;
                }
          - type: grid
            columns: 2
            cards:
              - type: custom:mushroom-entity-card
                entity: input_number.pet_temp_min
                name: Min Temp
                icon: mdi:thermometer-chevron-down
                icon_color: blue
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: input_number.pet_temp_max
                name: Max Temp
                icon: mdi:thermometer-chevron-up
                icon_color: red
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: sensor.lounge_temperature
                name: Current Temp
                icon: mdi:thermometer-lines
                secondary_info: state
                icon_color: >
                  {% set temp = states('sensor.lounge_temperature') | float(0)
                  %}

                  {% set min = states('input_number.pet_temp_min') | float(0) %}

                  {% set max = states('input_number.pet_temp_max') | float(0) %}

                  {% if temp < min or temp > max %}red

                  {% else %}green

                  {% endif %}
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: input_number.bark_level_db
                name: Bark Level
                icon: mdi:dog-service
                icon_color: deep-orange
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                      margin: 4px 0 !important;
                    }
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## ⚙️ System Settings
              *Quiet hours and timeouts*
            card_mod:
              style: |
                ha-card {
                  background: none !important;
                  box-shadow: none !important;
                  padding: 16px 0 4px 0 !important;
                  margin: 0 !important;
                  font-weight: 700 !important;
                  color: #1f2937 !important;
                }
                h2 {
                  font-size: 18px !important;
                  margin: 0 0 4px 0 !important;
                }
                em {
                  font-size: 13px !important;
                  color: #6b7280 !important;
                }
          - type: grid
            columns: 3
            cards:
              - type: custom:mushroom-entity-card
                entity: input_datetime.quiet_start
                name: Quiet Start
                icon: mdi:weather-night
                layout: vertical
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: input_datetime.quiet_end
                name: Quiet End
                icon: mdi:weather-sunset-up
                layout: vertical
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
              - type: custom:mushroom-entity-card
                entity: input_number.appliance_timeout_minutes
                name: Timeout
                icon: mdi:timer-outline
                layout: vertical
                card_mod:
                  style: |
                    ha-card {
                      background: white !important;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
                      color: #1f2937 !important;
                    }
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## 🏠 Interactive Floorplan
              *Visual home control*
            card_mod:
              style: |
                ha-card {
                  background: none !important;
                  box-shadow: none !important;
                  padding: 16px 0 4px 0 !important;
                  margin: 0 !important;
                  font-weight: 700 !important;
                  color: #1f2937 !important;
                }
                h2 {
                  font-size: 18px !important;
                  margin: 0 0 4px 0 !important;
                }
                em {
                  font-size: 13px !important;
                  color: #6b7280 !important;
                }
          - type: custom:mushroom-template-card
            primary: View Full Floorplan
            secondary: Interactive home layout with device controls
            icon: mdi:floor-plan
            icon_color: blue
            layout: horizontal
            tap_action:
              action: navigate
              navigation_path: /lovelace/floorplan
            card_mod:
              style: |
                ha-card {
                  background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%) !important;
                  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25) !important;
                  border: 2px solid #3b82f6 !important;
                  color: #1f2937 !important;
                  cursor: pointer !important;
                  margin: 8px 0 16px 0 !important;
                }
  - title: Analytics
    icon: mdi:chart-line
    type: sidebar
    background: >
      radial-gradient(ellipse at top left, rgba(191, 219, 254, 0.6) 0%,
      transparent 50%),

      radial-gradient(ellipse at bottom right, rgba(219, 234, 254, 0.5) 0%,
      transparent 50%),

      linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0f9ff 100%)
    cards:
      - type: custom:mushroom-title-card
        title: Analytics & Insights
        subtitle: Power • Energy • Events
        card_mod:
          style: |
            ha-card {
              background: rgba(255, 255, 255, 0.95) !important;
              box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
              color: #1f2937 !important;
            }
      - type: markdown
        content: |
          ## ⚡ Power Monitoring
        card_mod:
          style: |
            ha-card {
              background: none !important;
              box-shadow: none !important;
              padding: 12px 0 4px 0 !important;
              font-weight: 700 !important;
              color: #1f2937 !important;
            }
      - type: history-graph
        title: Power Draw (W) — 24 Hours
        hours_to_show: 24
        entities:
          - sensor.kettle_power
          - sensor.tv_power
          - sensor.white_noise_power
        card_mod:
          style: |
            ha-card {
              background: white !important;
              box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
            }
      - type: markdown
        content: |
          ## 📊 Energy Consumption
        card_mod:
          style: |
            ha-card {
              background: none !important;
              box-shadow: none !important;
              padding: 16px 0 4px 0 !important;
              font-weight: 700 !important;
              color: #1f2937 !important;
            }
      - type: history-graph
        title: Energy Usage (kWh) — 24 Hours
        hours_to_show: 24
        entities:
          - sensor.tv_energy
          - sensor.kettle_energy
          - sensor.white_noise_energy
          - sensor.house_energy_today
        card_mod:
          style: |
            ha-card {
              background: white !important;
              box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
            }
      - type: markdown
        content: |
          ## 📝 System Events
        card_mod:
          style: |
            ha-card {
              background: none !important;
              box-shadow: none !important;
              padding: 16px 0 4px 0 !important;
              font-weight: 700 !important;
              color: #1f2937 !important;
            }
      - type: logbook
        title: Event Log — 24 Hours
        hours_to_show: 24
        entities:
          - switch.kettle_switch
          - switch.tv_switch
          - switch.whitenoise_switch
          - input_boolean.block_fun
          - input_boolean.doorbell_muted
          - input_boolean.overlay_wfh
          - input_boolean.overlay_pet_home
          - input_boolean.sim_doorbell
        card_mod:
          style: |
            ha-card {
              background: white !important;
              box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
            }
      - type: markdown
        content: |
          ## 🤖 Automation Status
        card_mod:
          style: |
            ha-card {
              background: none !important;
              box-shadow: none !important;
              padding: 16px 0 4px 0 !important;
              font-weight: 700 !important;
              color: #1f2937 !important;
            }
      - type: entities
        title: Active Automations
        entities:
          - automation.mode_exclusivity
          - automation.mode_orchestrator
          - automation.safety_quiet_hours_auto_off_kettle
          - automation.energy_budget_soft_block
          - automation.energy_enforce_fun_block
          - automation.wfh_overlay_on
          - automation.wfh_overlay_off
          - automation.wfh_doorbell_handler
          - automation.wfh_break_reminder
          - automation.wfh_meeting_dnd
          - automation.pet_overlay_on
          - automation.pet_comfort_band_watch
          - automation.pet_bark_calming
          - automation.pet_doorbell_calming
        card_mod:
          style: |
            ha-card {
              background: white !important;
              box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
            }
  - title: Floorplan
    icon: mdi:floor-plan
    type: panel
    background: >
      radial-gradient(ellipse at top left, rgba(191, 219, 254, 0.6) 0%,
      transparent 50%),

      radial-gradient(ellipse at bottom right, rgba(219, 234, 254, 0.5) 0%,
      transparent 50%),

      linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0f9ff 100%)
    cards:
      - type: picture-elements
        image: /local/floorplan/floorplan1.jpg?v=2
        elements:
          - type: state-label
            entity: input_boolean.mode_home
            prefix: '🏠 Home: '
            title: 'Mode: Home'
            style:
              top: 3%
              left: 18%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 13px
              color: '#10b981'
              background: rgba(255, 255, 255, 0.95)
              padding: 6px 12px
              border-radius: 10px
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: input_boolean.mode_home
            tap_action:
              action: call-service
              service: input_boolean.turn_on
              target:
                entity_id: input_boolean.mode_home
            style:
              top: 7%
              left: 18%
              transform: translate(-50%, -50%) scale(1.3)
              filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2))
          - type: state-label
            entity: input_boolean.mode_guest
            prefix: '👥 Guest: '
            title: 'Mode: Guest'
            style:
              top: 3%
              left: 28%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 13px
              color: '#a855f7'
              background: rgba(255, 255, 255, 0.95)
              padding: 6px 12px
              border-radius: 10px
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: input_boolean.mode_guest
            tap_action:
              action: call-service
              service: input_boolean.turn_on
              target:
                entity_id: input_boolean.mode_guest
            style:
              top: 7%
              left: 28%
              transform: translate(-50%, -50%) scale(1.3)
              filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2))
          - type: state-label
            entity: input_boolean.mode_sleep
            prefix: '😴 Sleep: '
            title: 'Mode: Sleep'
            style:
              top: 3%
              left: 38%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 13px
              color: '#3b82f6'
              background: rgba(255, 255, 255, 0.95)
              padding: 6px 12px
              border-radius: 10px
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: input_boolean.mode_sleep
            tap_action:
              action: call-service
              service: input_boolean.turn_on
              target:
                entity_id: input_boolean.mode_sleep
            style:
              top: 7%
              left: 38%
              transform: translate(-50%, -50%) scale(1.3)
              filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2))
          - type: state-label
            entity: input_boolean.mode_away
            prefix: '🚗 Away: '
            title: 'Mode: Away'
            style:
              top: 3%
              left: 48%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 13px
              color: '#f59e0b'
              background: rgba(255, 255, 255, 0.95)
              padding: 6px 12px
              border-radius: 10px
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: input_boolean.mode_away
            tap_action:
              action: call-service
              service: input_boolean.turn_on
              target:
                entity_id: input_boolean.mode_away
            style:
              top: 7%
              left: 48%
              transform: translate(-50%, -50%) scale(1.3)
              filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2))
          - type: state-label
            entity: input_boolean.overlay_wfh
            prefix: '💼 WFH: '
            style:
              top: 3%
              left: 68%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 13px
              color: '#10b981'
              background: rgba(255, 255, 255, 0.95)
              padding: 6px 12px
              border-radius: 10px
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: input_boolean.overlay_wfh
            tap_action:
              action: toggle
            style:
              top: 7%
              left: 68%
              transform: translate(-50%, -50%) scale(1.3)
              filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2))
          - type: state-label
            entity: input_boolean.overlay_pet_home
            prefix: '🐕 Pet: '
            style:
              top: 3%
              left: 78%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 13px
              color: '#f97316'
              background: rgba(255, 255, 255, 0.95)
              padding: 6px 12px
              border-radius: 10px
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: input_boolean.overlay_pet_home
            tap_action:
              action: toggle
            style:
              top: 7%
              left: 78%
              transform: translate(-50%, -50%) scale(1.3)
              filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2))
          - type: state-label
            entity: sensor.house_energy_today
            prefix: '⚡ Energy: '
            suffix: ' kWh'
            style:
              top: 5%
              left: 92%
              transform: translate(-50%, -50%)
              font-weight: 800
              font-size: 15px
              color: '#1f2937'
              background: rgba(255, 255, 255, 0.95)
              padding: 8px 14px
              border-radius: 12px
              box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15)
          - type: state-label
            entity: lock.front_door_sim
            prefix: '🚪 Front: '
            style:
              top: 47%
              left: 43%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 12px
              color: '#1f2937'
              background: rgba(255, 255, 255, 0.95)
              padding: 4px 10px
              border-radius: 8px
              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: lock.front_door_sim
            tap_action:
              action: toggle
            style:
              top: 51%
              left: 43%
              transform: translate(-50%, -50%) scale(1.5)
              filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.25))
          - type: state-label
            entity: lock.back_door_sim
            prefix: '🚪 Back: '
            style:
              top: 14%
              left: 87%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 12px
              color: '#1f2937'
              background: rgba(255, 255, 255, 0.95)
              padding: 4px 10px
              border-radius: 8px
              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: lock.back_door_sim
            tap_action:
              action: toggle
            style:
              top: 18%
              left: 87%
              transform: translate(-50%, -50%) scale(1.5)
              filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.25))
          - type: icon
            icon: mdi:doorbell
            title: Ring Doorbell
            tap_action:
              action: call-service
              service: input_boolean.turn_on
              target:
                entity_id: input_boolean.sim_doorbell
            style:
              top: 49%
              left: 16%
              transform: translate(-50%, -50%) scale(1.5)
              color: '#14b8a6'
              filter: drop-shadow(0 3px 6px rgba(20, 184, 166, 0.4))
          - type: state-label
            entity: switch.tv_switch
            prefix: '📺 TV: '
            style:
              top: 23%
              left: 66%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 12px
              color: '#1f2937'
              background: rgba(255, 255, 255, 0.95)
              padding: 4px 10px
              border-radius: 8px
              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: switch.tv_switch
            tap_action:
              action: toggle
            style:
              top: 27%
              left: 66%
              transform: translate(-50%, -50%) scale(1.5)
              filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.25))
          - type: state-label
            entity: switch.kettle_switch
            prefix: '☕ Kettle: '
            style:
              top: 52%
              left: 63%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 12px
              color: '#1f2937'
              background: rgba(255, 255, 255, 0.95)
              padding: 4px 10px
              border-radius: 8px
              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: switch.kettle_switch
            tap_action:
              action: toggle
            style:
              top: 56%
              left: 63%
              transform: translate(-50%, -50%) scale(1.5)
              filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.25))
          - type: state-label
            entity: switch.whitenoise_switch
            prefix: '🌊 Noise: '
            style:
              top: 72%
              left: 80%
              transform: translate(-50%, -50%)
              font-weight: 700
              font-size: 12px
              color: '#1f2937'
              background: rgba(255, 255, 255, 0.95)
              padding: 4px 10px
              border-radius: 8px
              box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15)
          - type: state-icon
            entity: switch.whitenoise_switch
            tap_action:
              action: toggle
            style:
              top: 76%
              left: 80%
              transform: translate(-50%, -50%) scale(1.5)
              filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.25))
          - type: state-label
            entity: sensor.lounge_temperature
            prefix: '🌡️ Lounge: '
            suffix: °C
            style:
              top: 20%
              left: 73%
              transform: translate(-50%, -50%)
              font-weight: 800
              font-size: 14px
              color: '#1f2937'
              background: rgba(255, 255, 255, 0.95)
              padding: 6px 12px
              border-radius: 12px
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12)
          - type: icon
            icon: mdi:sofa
            title: WFH Focus Scene
            tap_action:
              action: call-service
              service: scene.turn_on
              target:
                entity_id: scene.wfh_focus
            style:
              top: 33%
              left: 62%
              transform: translate(-50%, -50%) scale(1.2)
              color: '#10b981'
              filter: drop-shadow(0 2px 4px rgba(16, 185, 129, 0.3))
          - type: icon
            icon: mdi:flower-tulip
            title: Evening Relax Scene
            tap_action:
              action: call-service
              service: scene.turn_on
              target:
                entity_id: scene.evening_relax
            style:
              top: 33%
              left: 69%
              transform: translate(-50%, -50%) scale(1.2)
              color: '#fb923c'
              filter: drop-shadow(0 2px 4px rgba(251, 146, 60, 0.3))
  - title: Activity Feed
    icon: mdi:pulse
    type: sidebar
    background: >
      radial-gradient(ellipse at top left, rgba(191, 219, 254, 0.6) 0%,
      transparent 50%),

      radial-gradient(ellipse at bottom right, rgba(219, 234, 254, 0.5) 0%,
      transparent 50%),

      linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0f9ff 100%)
    cards:
      - type: custom:mushroom-title-card
        title: Activity Feed
        subtitle: Recent Actions & Triggers
        card_mod:
          style: |
            ha-card {
              background: rgba(255, 255, 255, 0.95) !important;
              box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
              color: #1f2937 !important;
            }
      - type: markdown
        content: |
          ## 🔔 Live Activity Stream
        card_mod:
          style: |
            ha-card {
              background: none !important;
              box-shadow: none !important;
              padding: 12px 0 4px 0 !important;
              font-weight: 700 !important;
              color: #1f2937 !important;
            }
      - type: custom:home-feed-card
        title: All Activity — Last 24 Hours
        card_id: policy_feed
        show_empty: false
        more_info_on_tap: true
        state_color: true
        history_days_back: 1
        max_item_count: 50
        scrollbars_enabled: true
        entities:
          - input_boolean.mode_home
          - input_boolean.mode_guest
          - input_boolean.mode_sleep
          - input_boolean.mode_away
          - input_boolean.overlay_wfh
          - input_boolean.overlay_pet_home
          - input_boolean.meeting_now
          - input_boolean.doorbell_muted
          - input_boolean.do_not_disturb
          - input_boolean.sim_doorbell
          - switch.kettle_switch
          - switch.tv_switch
          - switch.whitenoise_switch
          - input_boolean.block_fun
          - sensor.house_energy_today
          - sensor.kettle_power
          - sensor.tv_power
          - sensor.white_noise_power
          - sensor.lounge_temperature
        card_mod:
          style: |
            ha-card {
              background: white !important;
              box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
            }
      - type: markdown
        content: |
          ## 🤖 Automation Triggers
        card_mod:
          style: |
            ha-card {
              background: none !important;
              box-shadow: none !important;
              padding: 16px 0 4px 0 !important;
              font-weight: 700 !important;
              color: #1f2937 !important;
            }
      - type: logbook
        title: Last 12 Hours
        hours_to_show: 12
        entities:
          - automation.mode_exclusivity
          - automation.mode_orchestrator
          - automation.safety_quiet_hours_auto_off_kettle
          - automation.energy_budget_soft_block
          - automation.energy_enforce_fun_block
          - automation.wfh_overlay_on
          - automation.wfh_overlay_off
          - automation.wfh_doorbell_handler
          - automation.wfh_break_reminder
          - automation.wfh_meeting_dnd
          - automation.pet_overlay_on
          - automation.pet_comfort_band_watch
          - automation.pet_bark_calming
          - automation.pet_doorbell_calming
        card_mod:
          style: |
            ha-card {
              background: white !important;
              box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
            }
      - type: markdown
        content: |
          ## 👤 Manual Actions
        card_mod:
          style: |
            ha-card {
              background: none !important;
              box-shadow: none !important;
              padding: 16px 0 4px 0 !important;
              font-weight: 700 !important;
              color: #1f2937 !important;
            }
      - type: logbook
        title: Last 6 Hours
        hours_to_show: 6
        entities:
          - input_boolean.mode_home
          - input_boolean.mode_guest
          - input_boolean.mode_sleep
          - input_boolean.mode_away
          - input_boolean.overlay_wfh
          - input_boolean.overlay_pet_home
          - input_boolean.meeting_now
          - input_boolean.sim_doorbell
          - switch.kettle_switch
          - switch.tv_switch
          - switch.whitenoise_switch
        card_mod:
          style: |
            ha-card {
              background: white !important;
              box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
            }
      - type: markdown
        content: |
          ## 🔍 Quick Access
        card_mod:
          style: |
            ha-card {
              background: none !important;
              box-shadow: none !important;
              padding: 16px 0 4px 0 !important;
              font-weight: 700 !important;
              color: #1f2937 !important;
            }
      - type: entities
        title: Key Automations
        entities:
          - automation.mode_orchestrator
          - automation.safety_quiet_hours_auto_off_kettle
          - automation.energy_budget_soft_block
          - automation.wfh_doorbell_handler
          - automation.pet_comfort_band_watch
          - automation.pet_bark_calming
        card_mod:
          style: |
            ha-card {
              background: white !important;
              box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
            }
